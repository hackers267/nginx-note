+++
title = "常见问题"
date = 2023-09-27
[taxonomies]
tags = ["问题"]
[extra]
toc = true
+++

# 设置https无效的问题

当我们使用`nginx`的时候，我们会使用`https`来配置网站。但是有时候我们会遇到配置不生效的问题。在这个时候，我们可以通过以下几个方面来排除：

- 服务器是否开户了防火墙，如果开户了，防火墙是否放行了`443`端口
- 服务器平台的安全策略是否放行了`443`端口
- 使用的证书文件是否正确
- 使用的nginx版本是否支持`https`

## 查看服务器是否开户了防火墙

首先，我们可以通过以下命令来查看服务器是否开户了防火墙:

```shell
systemctl status firewalld
```

如果返回值是`running`，说明服务器开户了防火墙。如果返回值是`inactive`，说明服务器没有开户防火墙。

如果开启了防火墙，我们可以通过以下命令来查看防火墙是否放行了`443`端口:

```shell
firewall-cmd --zone=public --query-port=443/tcp
```

如果显示的是`no`，那么表示并没有放行`443`端口。如果显示的是`yes`，那么表示放行了`443`端口。没有你的系统没有放行`443`端口，可以使用以下命令来放行防火墙的`443`端口:

```shell
firewall-cmd --zone=public --add-port=443/tcp --permanent
```

## 服务器平台的安全策略

如果服务器的防火墙的配置没有问题，那么我们接下来就需要查看服务器平台的安全策略是否放行了`443`端口。关于各个平台的查看方法和设置方法，可以参考各个平台的帮助。

## 使用的证书文件是否正确

在配置`nginx`的https服务的时候，我们的证书文件通常来自于不同的平台，当我们下载证书文件的时候，平台可能会为我们提供多个服务类型的证书，比如`tomcat`,`IIS`,`Apache`和`Ningx`等。在我们配置文件的时候，一定要注意使用的是`Nginx`平台下的配置,并且证书所绑定的域名要和我们访问的域名保持一致才可以。

## 查看nginx是否支持https

如果我们的nginx使用的是源码编译的方式安装的话，那么我们就需要注意，在编译安装的时候，是否编译了`--with-http_ssl_module`模块。查看方式如下：

```shell
nginx -V
```

如果输出的`configure arguments`参数中有`--with-http_ssl_module`的话，那么说明nginx支持https。

如果在这个时候，还是不支持的话，那我们可以查看一下日志文件`/usr/local/nginx/logs/error.log`。查看其是否有没有能加载到`ssl`模块。如果有的话，那么就需要把你自己的文件先备份，然后删除`nginx`，再重新编译`nginx`(记得要加载`ssl`模块，即添加`--with-http_ssl_module`参数)。
